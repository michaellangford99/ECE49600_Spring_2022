\documentclass[a4paper]{article}

%% Language and font encodings
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}

%% Sets page size and margins
\usepackage[a4paper,top=3cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

%% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage[title]{appendix}
\usepackage[style=verbose]{biblatex}

%% matlab
\usepackage[framed,numbered,autolinebreaks,useliterate]{mcode}
\usepackage{verbatim}

\addbibresource{sample.bib}

\title{ECE49600 Undergrad Research Semester Report \\
  \large Photon counting for super-resolution imaging \\
  \large Spring 2022, 3 credit hours.  }

\author{Michael Langford \newline \\
        Instructor: Dr. Kevin Webb}

\begin{document}

\maketitle

\begin{abstract}
During the course of the semester, I worked to prepare for super resolution imaging lab experiments using photon counting apparatus via lab work conducting initial tests, and analyzing the resulting data. In addition to the experimental work I reviewed literature relating to photon counting and work with potential application to photon counting / super-resolution experiments planned for our group.

I was able to assist in conducting multiple tests of the photon counting equipment, with the goal validating its operation and characterizing its behaviour. The goal is to use this device in more complex setups for super-resolution imaging experiments. The equipment is newly acquired however, so it is first necessary to become acquainted with it and ensure it is operating within the advertised parameters. 
The tests primarily consist of using the photon counting equipment to measure the pulse shape of a pulsed laser and working to ensure the measured pulse matches, as closely as possible through iteration of experiments, the proscribed pulse shape from the pulsed laser. The more accurate the measurement of the pulse, the better we will be able to perform more complex experiments.

This device should be very useful in the future for multiple experiments where time-correlation of laser signals are desired, as this device is very helpful for collecting this information. In particular, we are interested in using photon counting devices to create a Hanburry Brown-Twiss Interferometer to access higher order correlation information. 
In the characterization of the hardware, multiple setups were used as issues were debugged and solutions found. I present the details of each setup as well as an analysis of the results of the experiments for each setup, and recommendations to improve the performance of the equipment for future usage in more complex experiments.

In reviewing published material, I read multiple papers with relevance to photon counting and super-resolution imaging, and learned about the various ways that super-resolution imaging is being done, and particularly how photon-counting is applicable to it.
In particular, I did a more in depth analysis of the math and algorithm described in a paper written on higher order correlations with relevance to photon counting, as the algorithm can be used on the output gathered from a Hanburry Brown-Twiss Interferometer, which may use be implemented via photon-counting. I worked to understand better the implications of the algorithm they describe, and the math of higher order correlations.
I detail what I learned from the paper and a high level overview of it, with an explanation of why it is of particular interest and how it might be useful to the group.

\end{abstract}

\section{Lab work}

\subsection{Introduction}

My lab work this semester focused on testing the photon counting equipment to prepare for super-resolution experiments where photon-counting data is required. Thus my work consists of a set of tests of the photon counting equipment as we gained more understanding of the device's operation and fixed issues contributing to error in the photon counting measurement.

The exact goal of this set of experiments is to direct a pulsed laser beam into the SPAD aperture, measure the resulting pulse waveform using the photon counting equipment, and then analyze the data and determine how closely the measured pulse matches the proscribed pulse shape of the pulsed laser waveform. The closer this measurement to the real pulsed laser waveform, the more accurate we can say the photon counting equipment is. Therefore with each setup the goal is to remove possible sources of noise, error, distortion, etc. to learn how to accurately measure a pulse waveform so that future measurements can be as accurate to the true waveforms as possible.

The photon counting equipment itself consists of a main control box that interfaces to a laptop, and the sensor, which is a SPAD (Single Photon Avalanche Diode) detector mounted within a containing aperture and additional integrated supporting electronics. The photon counting control box connects to the SPAD detector and a laptop, as well as a sync pulse cable coming from the pulsed laser source. This sync pulse allows the photon counting equipment to synchronize its measurements in time to the beginning of a laser pulse.

In addition to the photon counting devices the experiments utilized multiple lasers and their associated devices, along with typical optical table items such as mirrors, filters, lenses, etc.

\subsection{SPAD}

An introduction to the SPAD device itself is in order to understand the reasons guiding the setup and parameters used in each experiment.

At high rate of acquisition and at an invariant interval, the photon counting setup measures the time required for the SPAD to detect the arrival of a single photon. Once it has arrived, the SPAD undergoes complex electrical changes and it is not ready for another detection until the next acquisition interval, though this happens quickly. By plotting a histogram of number of photons that have arrived within a certain time step vs. time, and measuring an optical signal repeatedly (one that can be repeated with an extremely high degree of similarity, e.g. a periodic laser pulse), one can recover the intensity vs. time properties of the signal, and in our application, the pulse shape of the laser pulse incident upon the detector.

There are peculiarities to this method of extracting the pulse shape that are important to remember. Vital is the observation that the SPAD takes advantage of the quantum properties of light, and so either detects one photon, or none for a given instant in time, and once one is detected, it cannot detect again until the next repetition of the signal. Clearly then, the signal must not be so powerful that the probability of a photon arriving from the start of the pulse is high enough to prevent a photon from the tail end of the pulse from being the first to arrive at the detector (all prior photons being either attenuated or having never been transmitted due to their probabilistic nature).

Because the attenuation is time invariant, there is equal probability of photons being attenuated at any point within the laser pulse. With the attenuation low enough such that only one photon or none usually arrive within a single pulse, there will be negligible distortion of the pulse shape from early-arriving photons ‘shadowing’ the tail of the pulse. With the attenuation set properly (in most applications the recommended probability of arrival at all over the entire sensing period is 0.05 or less), the SPAD setup can repeatedly measure photon arrival times, bin them, and create a histogram that accurately represents the waveform of the laser pulse in question.

In addition to the proper attenuation of the laser signal, the timing of the signal is critical. In order to correctly timestamp a photon arrival relative to the beginning of the laser pulse, the photon counting hardware is connected to the laser source via a 'sync pulse' line, an electrical cable that sends out inverted electrical pulses that signal the beginning of a laser pulse.

Timing error in this sync line from the laser source, or phase noise / jitter, can be the cause of a spread in the pulse shape that can appear as if caused by a physical source. Random variation over time of this timing results in incorrect binning of photon arrival times, and the signal becomes spread out / smeared across time. Because the photon counter uses the sync pulse as its temporal reference point, it bins each photon arrival relative to that timestamp, so a random variation in the discrepancy between the sync pulse and the laser signal results in improper binning that differs from the correct time position by a different amount each pulse, which over the course of a measurement results in temporal dispersion of the pulse shape.

\subsection{Initial Setup}
The initial setup used at the beginning of the photon counting experiments consisted of a standalone 635nm Horiba laser diode aimed through a collimating lens, mirrors, and an ND filter, and then into the aperture of the photon counter SPAD. The timing and laser supply controls were kept off to the side together for ease of control.

Initially efforts were focused on getting the photon counter to properly record and bin the photon arrivals at the correct timescale relevant to the expected pulse width, and ensuring the the probability of arrival of a photon at the SPAD aperture was below the recommended threshold. Once this was completed however, it was noticed that the measurement of the pulse width was significantly higher than expected, by orders of magnitude.

Fig.\ref{fig:pulse_1} shows the distorted pulse shape with a decaying tail, much different from the expected symmetrical pulse shape.

Efforts to combat this were based off the idea that photons could be bouncing off items in the setup and resulting temporal dispersion, as some photons would randomly take much longer to arrive. If this effect was independent of the point in the pulse the photon was from, this simply yields the new pulse width as being the convolution of the possible arrival delay range due to the bounces, and the original pulse. This is essentially the temporal point spread function of the device.

The other possible cause of the spread in the pulse shape is the presence of phase noise in the sync line coming into the photon counter from the laser source. Any issues in the precision of this timing results in incorrect binning of photon arrival times, and the signal becomes spread out / smeared across time.

\begin{figure}
\centering
\includegraphics[width=1.0\textwidth]{figures/horiba laser.PNG}
\caption{\label{fig:pulse_1}Pulse measurement with clear temporal dispersion}
\end{figure}

\subsection{Switch to off-table laser}

Due to the dispersion apparent with the Horiba laser, it was decided to switch to the Spectraphysics laser source which had a reliable sync pulse signal. However, this laser at the time was mounted on a separate table, and was unable to be moved due to it's usage in a separate experiment. In order to use the laser, a setup was devised using a fiber cable coupled to the Spectraphysics laser with a simple mount that allowed the laser to shine directly onto the fiber input and couple the beam into it. This fiber was then routed to the original laser table and mounted to have its output shine directly onto a similar sequence of mirrors and and ND filter as before. Fig.\ref{fig:nkt_fiber_coupling} shows the coupling of the Spectraphysics laser into the fiber, which then is routed up through the roof of the lab and then down onto the original laser table as shown in Fig.\ref{fig:fiber_output}

\begin{figure}
     \centering
     \begin{subfigure}[t]{0.25\textwidth}
         \centering
         \includegraphics[angle=270,origin=c,width=\textwidth]{figures/20220228_174444.jpg}
         \caption{Fiber coupling setup on separate table}
         \label{fig:nkt_fiber_coupling}
     \end{subfigure}
     \hfill
     \begin{subfigure}[t]{0.25\textwidth}
         \centering
         \includegraphics[angle=270,origin=c,width=\textwidth]{figures/20220228_174340.jpg}
         \caption{Fiber output to photon counting setup}
         \label{fig:fiber_output}
     \end{subfigure}
     \hfill
     \begin{subfigure}[t]{0.4\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/IMG_6137.jpg}
         \caption{Fiber run through ceiling}
         \label{fig:fiber_ceiling}
         \begin{minipage}{2cm}
         \vfill
         \end{minipage}
     \end{subfigure}
        \caption{Fiber coupled laser setup}
        \label{fig:fiber}
\end{figure}

\subsection{Fiber setup results and issues}

After the hardware setup was complete and the fiber coupling properly, the photon counting hardware was used to analyze the pulse. The resulting graph was not nearly as clean as expected however, and displayed multiple anomalies. First, though the pulse width of the Spectraphysics laser should have been close to 0.4ps, the pulse width seen upon inspection of the photon counting histogram was much larger, and was not symmetric as well as quite noisy.

The first anomaly is that there are 3 separate superimposed pulse shapes in the output as seen in Fig.\ref{fig:fiber_graph_no_hand}. The first is a quick pulse that has almost entirely dropped off before the arrival of the next, widest pulse, followed by a sharp, high amplitude pulse located within the tail of the wide pulse. 

The short beginning pulse was theorized to be cause by laser light coming from the laser table where the Spectraphysics laser was located bouncing off optical elements and the white back wall and then into the SPAD aperture. Because the fiber was coupled on the table in an open environment with many different optical paths (the Spectraphysics source was split and used for multiple experiments simultaneously), there was a significant amount of scattered laser light illuminating the back wall, apparent very clearly by eye. The short initial pulse was suspected as being the pulse caused by the reflected laser light because it arrives first, meaning the light took less time to arrive at the aperture. Due to the nature of the fiber, and its significant length, the pulse would take longer to travel through the fiber and into the aperture than to only bounce off the wall and across the tables into the aperture.

To test whether this scattered light from the table was the cause of the early initial pulse, the aperture was shielded from any laser light coming from any source other than the fiber. Initially, a person stood between the two tables to block the non-fiber light, and the resulting histogram was Fig.\ref{fig:fiber_graph_hand}. It clearly shows an almost complete removal of the initial pulse. The cross-table bounce then serves as a satisfactory explanation for the initial pulse, however the 2 other pulses must now be accounted for.

%%%The suspected cause of the 2 other pulses is modal dispersion, as the fiber used was a multi-mode fiber. An additional factor leading this to be suspected is that upon close visual inspection of the laser light output from the fiber, multiple different interference patterns were visible, indicative that the laser pulse was exciting multiple modes within the fiber simultaneously. The result of such multi-mode propagation is that, due to differences in propagation velocity of different modes, the arrival time of the pulse carried by each mode will be different, and the output will be the superposition of each mode's transmission.

%
%Put the multi-mode fiber analysis here
%

\begin{figure}
     \centering
     \begin{subfigure}[b]{1.0\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/550_no_hand.PNG}
         \caption{Histogram results with no shielding, note initial spurious pulse}
         \label{fig:fiber_graph_no_hand}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{1.0\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/550-actually covered.PNG}
         \caption{Histogram with shielding, first spurious pulse attenuated}
         \label{fig:fiber_graph_hand}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{1.0\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/pulse_clear.PNG}
         \caption{Pulse measurement showing much cleaner pulse than Fig.\ref{fig:fiber_graphs}}
         \label{fig:fiber_output_shielded}
     \end{subfigure}
        \caption{Fiber setup initially with multiple back reflection paths}
        \label{fig:fiber_graphs}
\end{figure}

A more elaborate shielding setup was devised using black cardstock to cover the SPAD, in order to determine if the second, longer duration pulse was also due to the many sources of laser reflections from the other table, and if so attenuate them. It is expected that the third, highest intensity, and shortest duration pulse will be the pulse coming through the fiber, as the output is directed right at the SPAD and should have much higher intensity, and less duration compared with the sum of the multiple reflection sources.
The shielding used was a simple cover of black cardstock along with some cardboard boxes and packing material to ensure the SPAD aperture was not directly visible to any laser light that might be coming from the back table, and any other ambient light as well. The setup can be seen in Fig.\ref{fig:fiber_shielded_front}.

%\begin{figure}[!htb]
%     \centering
%     \begin{subfigure}[b]{0.48\textwidth}
%         \centering
%         \includegraphics[angle=270,origin=c,width=\textwidth]{figures/IMG_6135.jpg}
%         \caption{Full shielding setup, facing away from table with laser}
%         \label{fig:fiber_shielded_front}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.48\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{figures/IMG_6136.jpg}
%         \caption{Full shielding setup, side view}
%         \label{fig:fiber_shielded_side}
%     \end{subfigure}
%        \caption{Fiber setup with shielding}
%        \label{fig:fiber_shield}
%\end{figure}

\begin{figure}
\centering
\includegraphics[angle=270,origin=c,width=0.5\textwidth]{figures/IMG_6135.jpg}
\caption{\label{fig:fiber_shielded_front}Full shielding setup, facing away from table with laser}
\end{figure}

The results of a measurement after the addition of this shielding indicate that all the pulses with the exception of the high intensity short duration pulse, as expected, were the result of back-reflections from the back wall and other optical elements on the other table. The histogram from this measurement is shown in Fig.\ref{fig:fiber_output_shielded}. It appears to have by inspection a FWHM of 0.4-0.5ns which is significantly longer still than the promised 0.4ps, although the pulse appears now much closer to gaussian, as is the pulse shape of the laser. Phase noise of the sync pulse is the expected cause of this error, though in future data should be recorded concerning the behaviour of the sync pulse to determine how much it contributes to the total error and pulse spreading.

\subsection{Setup with NKT laser on same table}

After the issues with the previous setup not giving the desired accuracy to the input pulse, and an NKT laser being freed up from its previous usage in another setup, the NKT laser was moved to the same table as where the photon counting equipment and SPAD reside. This allowed the laser pulse to be routed directly from the output aperture through just a few optical elements before arriving at the SPAD detector.

Beneath the laser table was placed the NKT super-continuum laser source shown in Fig.\ref{fig:super_continuum}, with the laser signal routed up to the table to a variable band-pass filter in Fig.\ref{fig:band_pass}, allowing the entire setup to act as a variable wavelength narrow-band laser source.

\begin{figure}
     \centering
     \begin{subfigure}[b]{0.48\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/IMG_20220422_134723634_HDR.jpg}
         \caption{NKT super-continuum laser source}
         \label{fig:super_continuum}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.48\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/IMG_20220422_134731107_HDR.jpg}
         \caption{NKT SuperK Varia band-pass filter}
         \label{fig:band_pass}
     \end{subfigure}
        \caption{NKT laser}
        \label{fig:NKT_laser_setup}
\end{figure}

The output of the laser from the band-pass filter was then directed into a beam collimator, 45deg mirror, and an ND filter before being directed into the SPAD aperture. It was not possible to find posts such that the laser output and the SPAD aperture would be on the same horizontal plane, so the collimator we adjusted to direct the beam upward so that the vertical differential was removed. With the ND filter properly adjusted such that the probability of arrival of a photon within a pulse was below the recommended threshold, the setup was ready for measurement.

The complete setup is shown in Fig.\ref{fig:nkt_same_table}.
Measurement results were recorded and shown in Fig.\ref{fig:python_graph}.

\subsection{Initial Results}

The measurement resulting from this experimental setup appear much cleaner and more symmetrical than previous setups, with the pulse width appearing much shorter. As opposed to previous results, the measured waveform is mostly gaussian and nearly symmetrical, which is desired as that is the shape of the pulsed laser directed at the SPAD aperture. Although much narrower than previous experiments, it does not appear to be in the range of the 5ps pulse width of the NKT laser used in this experiment.

\begin{figure}
\centering
\includegraphics[width=0.6\textwidth]{figures/IMG_20220422_142651049_HDR.jpg}
\caption{\label{fig:nkt_same_table}NKT laser full setup}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=1.0\textwidth]{figures/python_pulse_graph.png}
\caption{\label{fig:python_graph}Pulse histogram from python script}
\end{figure}

\subsection{Full width half max measurement}

In order to better characterize the laser pulse, the histogram data from the SPAD measurement was passed through a custom python script to calculate the FWHM of the pulse.
Using the data exported from the SPAD histogram measurement, the python script finds the maximum pulse amplitude, in histogram counts, and then the timestamps of the bin counts with half of the maximum counts.

The script takes as an input the .dat file generated by the photon counting control software, which contains the raw photon count data and binning units needed to properly reproduce the histogram. The script then generates from the a plot of the histogram as well as a automatically calculated FWHM measurement. Fig.\ref{fig:python_graph} shows the resulting plot of the histogram for this measurement and setup. Below is the console output of the script, displaying intermediate measurements as well as the final FWHM measure

\begin{verbatim}
ns per bin:             0.02 [ns]
min_index:              138
max_index:              143
max_count:              52169
full_width_half_max:    0.1 [ns]
\end{verbatim}

The result of this analysis is a FWHW of 100 ps. The advertised FWHM pulse duration of the laser at \(\lambda\) = 635nm is 5ps, so clearly there must be some dispersive error, or measurement error.

\subsection{Temporal dispersion \& error origin analysis}

Upon review of the laser pulse measurement, there is a clear disparity between the measured pulse width and the advertised pulse width from the laser manual, as the measured pulse width is 100ps, and the advertised width is 5ps. There are a number of suspected sources of error causing this dispersive error, such as phase noise in the electrical sync pulse, phase noise in the laser pulse itself, vibration, and multiple path back reflections. Each are investigated to determine which could be a dominant cause of error in the measurement, as well as to determine possible solutions.
\newline

To better understand the properties of the system resulting in this dispersion of the pulse signal, a simple deconvolution was performed on the measured data to recover an approximation of the temporal point spread function (PSF) of the system. From this PSF multiple conclusions can be drawn about the nature of the system and the origins of the error.

The mathematics for a simpler, more naive approach to deconvolution are not very complex, and essentially only entail solving for the PSF in the s-domain. The Laplace transform allows algebraic manipulation of the functions in the s-domain when convolution occurs in the time domain.

\[
z_{measurement} (t) = x_{pulse} (t) \ast psf (t)
\]
\[
\mathcal{L}\{z_{measurement} (t)\} = \mathcal{L}\{x_{pulse} (t) \ast psf (t)\}
\]
\[
Z_{measurement} (s) = X_{pulse} (s) \cdot PSF (s)
\]
\[
PSF (s) = \frac{Z_{measurement} (s)}{X_{pulse} (s)}
\]
Evaluation along the \(j\omega\) axis allows use the Fourier transform, and in the discrete time domain the FFT \& iFFT.
 \[
PSF (j\omega) = \frac{Z_{measurement} (j\omega)}{X_{pulse} (j\omega)}
\]
 \[
psf (t) = \mathcal{F}^{-1}\{\frac{Z_{measurement} (j\omega)}{X_{pulse} (j\omega)}\}
\]
\[
psf (t) = \mathcal{F}^{-1}\{\frac{\mathcal{F}\{z_{measurement} (t)\}}{\mathcal{F}\{x_{pulse} (t)\}}\}
\]

This solution for finding the pulse was then implemented in Matlab/Octave. The signal was first imported in .csv format from the output of the python script that processed the raw data from the SPAD, then interpolated to allow for a smooth approximation of the laser pulse  input (the time step output from the SPAD was too close to  size of the laser pulse). Next an estimate of the input laser pulse was calculated using a gaussian pulse shape to approximate the unknown physical pulse shape, as a gaussian is the expected pulse shape of a properly operating laser. Then FFTs were taken of both the simulated input signal and the measured output signal. 

To prevent division by very small numbers, the FFT of the measured signal was truncated by setting to zero all sections of the data where the pulse FFT intensity was below 0.002\% of the max intensity of the pulse FFT, and then any NaN or Inf values within the PSF FFT after the complex division operation were set to zero.

With all invalid data removed, the inverse FFT of the PSF FFT was taken to get the time domain PSF \(psf(t)\).  The completed script output the FWHM of the PSF as a sanity check to compare with the python script result, the FFT of each signal involved, the simulated pulse waveform, and the PSF and measured output graphed on the same plot.
The truncation operation is visible in Fig.\ref{fig:deconvolution_ffts}, as both the original FFT and the truncated FFT are shown. This allows calculation of the PSF without massive high-frequency noise signals swamping the smaller data in the valid range (lower frequency) resulting from the signal part of the FFT spectrum.
The simulated pulse shape assumed in this analysis is shown in Fig.\ref{fig:deconvolution_pulse}, showing the ideal gaussian pulse utilized.

\begin{figure}
     \centering
     \begin{subfigure}[b]{1.0\textwidth}
         \centering
        \includegraphics[width=1.0\textwidth]{figures/matlab_deconvolution_all_signals_FFT.jpg}
         \caption{FFTs of signals in the deconvolution process}
         \label{fig:deconvolution_ffts}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{1.0\textwidth}
         \centering
         \includegraphics[width=1.0\textwidth]{figures/matlab_deconvolution_pulse.jpg}
         \caption{Simulated pulse shape used in deconvolution process}
         \label{fig:deconvolution_pulse}
     \end{subfigure}
        \caption{Deconvolution results}
        \label{fig:deconvolution_graphs}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=1.0\textwidth]{figures/matlab_deconvolution_all_signals.jpg}
\caption{\label{fig:deconvolution_time_domain}Resulting time domain graph of PSF and measured signal}
\end{figure}

Fig.\ref{fig:deconvolution_time_domain} shows the PSF and the original measured pulse alongside each other. This graph gives the most useful information about the nature of the system. The PSF's primary pulse appears to be mostly gaussian, with only one major pulse, and one much weaker pulse of similar shape. The pulses are much stronger than the noise surrounding the signals, which demonstrates a good SNR in terms of any ambient light reaching the detector. The presence of the 2 pulses indicates there is some sort of back reflection occurring that results in a temporal delay of approx. 3.056ns.

The fact that the the pulses shapes are gaussian and mostly symmetrical indicates the presence of random noise as the source of the temporal dispersion that the PSF shows. Due to the PSF being a gaussian in particular, this would mean a time invariant IID random process being the source of the noise. Some noise sources that have this property would be phase noise in the electrical sync pulse signal, phase noise in the laser pulse itself, and vibration on the laser table.
\newline

A possible explanation of the second pulse is back reflections caused by photons bouncing off of the ND filter in front of the SPAD aperture and then off other optical equipment, and then back into the SPAD.

To investigate this, the dimensions of the most likely bounce path were measured and the traversal time the would elapse for it to cover that distance were calculated. Then these times can be compared to the measured 3.06ns bounce time predicted by the calculated PSF.
The most likely bounce paths appear to be approx. 20 inches, 15 inches, and 1 inch, based off a 1 inch hole spacing on the laser table, and the paths are shown in Fig.\ref{fig:light_path_measured}.

%
% [!htb]
%

\begin{figure}
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/IMG_20220422_142643396_HDR.jpg}
         \caption{Possible light bounce path}
         \label{fig:light_path}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/distance_drawing.png}
         \caption{Approx. bounce path measurement}
         \label{fig:light_path_measured}
     \end{subfigure}
        \caption{Bounce Path Analysis}
        \label{fig:light_path_all}
\end{figure}

Using the approximate measurements from the pictures of the setup, we get traversal times based upon the following equation, showing the results for each possible path length.

\[
\Delta T=\\
\begin{bmatrix}
20\\
15\\
1\\
21\\
\end{bmatrix}
\ in * 2 * \frac{2.54\ cm}{1\ in} * \frac{1\ m}{100\ cm} * \frac{1}{c} = \\
\begin{bmatrix}
3.3867\\
2.5400\\
0.1693\\
3.5560\\
\end{bmatrix}
ns
\]

Both the 20" and 15" paths are close to the expected 3ns bounce time as calculated from the PSF - both of which are likely candidates for back reflections based on observed diffuse laser light present at those locations during the measurements. This seems to be a satisfactory explanation for the second pulse and its 3ns relative delay.

With the multiple pulses explained, the origin of the noise causing the pulse spread shown by the PSF for both pulses must be discussed. Since it is expected that it is a time invariant IID random process, these would be phase noise in the electrical sync pulse signal, phase noise in the laser pulse itself, and vibration on the laser table. As discussed in the explanation of the operation of the SPAD, any phase noise or variation in the arrival of the edge of the sync pulse will result in the temporal reference point for the timestamp of a photon arrival being improperly placed relative to the actual pulse timestamp, and variation in this error over time results in spreading of the pulse measurement.
Likewise, any presence of this noise in the actual laser signal would have the same result, although due to the opposite effect, where the electrical signal gave the true timestamp and the pulse was not synchronized properly.
If either is present these would contribute to each other with the resulting PSF from the phase noise being the convolution of the individual PSFs from the respective delays - the PSF from phase noise being a gaussian, as the ensemble of random IID measurements of a uniform pdf random variable is a gaussian distribution.

Aside from phase noise in the electrical or optical pulse, vibration is a possible source of dispersive error. Similar to the improper binning resulting from phase noise, if the SPAD, as well as the laser, is susceptible to environmental vibration, the detector will vary in its position relative to the mean position of the detector along the path of the laser beam. This will result in photon arrival being either delayed or advanced by the change in the detector position. However, by rearranging the equation used to determine the bounce times of various paths, and solving for distance using a time delta of 0.12ns, it would require a maximum vibration delta or +/- 1.4 in. to result in as wide of a PSF as seen here. As a result, vibration seems to be an extremely unlikely source of error.

\subsection{Future steps, recommendations}

After analyzing the results of each lab setup and the implications of the data, there are some goals and planned experiments for future lab-work related to these experiments. For each setup, there was significant temporal dispersion, and while the best explanation available is phase noise in the electrical sync pulse signal, it is not very satisfactory to merely chalk it all up to that noise source. It is not yet known what the magnitude of the contribution of this error is, and therefore may not be the dominant source of error here.

First hard data should be gathered on the noise properties of the sync pulses from each of the lasers used in these setups, to determine just how much they could contribute to the error. Using this information to create a probability density function of the timing error introduced for a given photon measurement could then be incorporated into a more precise formulation of the PSF of the detector system and allow for clearer analysis of the data quality. Furthermore, identification of phase noise in the electrical signal as the dominant noise source allows focus to be given to that issue to reduce its impact by finding solutions such as shortening the sync pulse cable, or finding an optical synchronization method that is less susceptible to variation.

To verify the bounce times of theorized bounce paths, it would be beneficial to intentionally create back-reflection situations with known traversal lengths to see how accurately the device can measure distance as well. For all measurements the setup has assumed to have been properly calibrated in time, however the accuracy of this data is not yet known, and the precision of the distance measurement would help in establishing this.

Indirectly related to photon counting is the future use of an autocorrelator, which was attempted unsuccessfully this semester due to hardware issues. An autocorrelator's precision at very small time-scales allows it to accurately measure a pulse shape, and therefore we can validate our photon-counting pulse shape and FWHM via this apparatus. This is also helpful as the laser pulse is assumed based on performance specifications to be a gaussian pulse, however the autocorrelator would help to experimentally establish that fact as well as its exact pulse length, waveform shape, and spectral content.

Recommendations going forward as a result of these experiments are all related to noise reduction. It appears that the most important factors in reducing error and noise are reduction of ambient light arriving at the SPAD, removal of any possible back reflection sources, minimizing phase noise in electrical sync line.

\section{Literature Review}
\subsection{Phase and amplitude recovery from bispectra}
\textbf{High level Summary}: This paper discusses a computational method of signal reconstruction and phase recovery using the Fourier transform of the triple-correlation of a signal, the bi-spectra \footcite{Bartelt:84}. The bi-spectra is important as it may be gained via a Hanbury-Brown-Twiss interferometer setup, which then can be fed through this algorithm to gain the original signal. The paper notes benefits of using the triple-correlation / bi-spectra of a signal for signal recovery, as it contains an additional dimension of information and with the information duplicated due to symmetry in the additional dimension there is a significant reduction in noise. 

\textbf{Details}:  I was interested in understanding better the implications of the algorithm they describe, and the math of higher order correlations. This paper discusses a computational method of signal reconstruction and phase recovery using the Fourier transform of the triple-correlation of a signal, the bi-spectra \footcite{Bartelt:84}. The triple correlation of a signal is simply an extension of the familiar correlation function into 2 dimensions.

\[ 
R_{fff}\left(\tau_1,\tau_2\right)=\int_{-\infty}^{\infty}f\left(t\right)f\left(t+\tau_1\right)f\left(t+\tau_2\right)dt
\]
The result of this is a 2D function, with the shifts as the parameters. An easy way to visualize this is to plot the 3 versions of f(t) above each other, and then plot the multiplication of the three below those. See Fig.\ref{fig:triple_correlation_explanation}. The integral of that bottom function is then the value of the triple-correlation at that $\tau_1$,$\tau_2$. The triple correlation evaluated for all \(\tau_1, \tau_2\) pairs within the defined range is displayed as an image plot in \ref{fig:triple_correlation_img}. These plots are the result of Matlab experimentation with the goal of coming to a better understanding of the correlation math as well as serving as a starting point for eventual replicating the reconstruction algorithm.

\begin{figure}
     \centering
     \begin{subfigure}[b]{1.0\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/triple_correlation.png}
         \caption{Triple correlation pieced together.}
         \label{fig:triple_correlation_explanation}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.7\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/triple_correlation_img.png}
         \caption{Triple correlation 2D function evaluation.}
         \label{fig:triple_correlation_img}
     \end{subfigure}
        \caption{Triple correlation intuition and results}
        \label{fig:triple_correlation}
\end{figure}

With the bispectra being an available measurement from which to attempt to recover the original signal,  it is useful to notice that the bispectra is essentially the fourier transform of the original signal multiplied by itself with different shifts:

\[T\left(x_1,x_2\right)=  \int T\left(x\right)T\left(x+x_1\right)T(x+x_2)\]
\[\mathcal{F}\left(T\left(x_1,x_2\right)\right)\left(w_1,w_2\right)=\ \widetilde{T}(w_1)\widetilde{T}(w_2)\widetilde{T}(-w_1-w_2)\]
Where $\widetilde{T}(w)$ is the Fourier transform of the original signal. The paper then proves their assertion that \textit{If T(x) is real and of finite extent, T(x) can be reconstructed from its bispectrum except for a shift a. Equivalently, the Fourier transform T(u) of T(x) is determined except for a linear phase factor.}
They begin with the proof that the bispectrum is unaffected by a time shift in T, or a multiplication by a linear phase shift in the frequency domain (which are equivalent operations).

After this proof, they describe an iterative algorithm capable of scanning the recorded data of the triple correlation FFT / bi-spectra data and generating an estimate of the original signal with very good noise robustness. The primary issue here, as is the case in many signal recovery algorithms, is the phase problem, which is the result of most optical measurements being unable to record the phase of a signal and so only recording the magnitude of a complex number. Then if any Fourier transform based calculations are done to process the signal, they are made without knowledge of the signal's phase at any point, forcing researchers to get very inventive in recovery algorithm design.

As mentioned before, the symmetry of the bispectra/triple-correlation implies duplication of data allowing improved noise tolerance. Alternatively, if portions of the symmetrical signal are lost rather than distorted by noise, they can be recovered using the symmetry rules described within, resulting in a greater tolerance of noise and data loss. Merging these methods, if portions of symmetrical data disagree, they can be reconciled based on an estimate of which section is more accurate to reality. 

\textbf{Takeaways relevant to the lab group}: This is relevant to the group and in particular to photon counting experiments as photon counting is a very viable experimental technique for forming a HBT Interferometer and then gaining the previously mentioned bispectra, and from this the original signal using the described signal reconstruction algorithm. If an HBT setup is used using the photon counting equipment, an implementation of this recovery algorithm could prove very useful. The noise tolerance properties of this method also make it an attractive signal recovery method as photon counting has many inherent noise sources. This pairing could help to offset introduction of noise due to the nature of photon counting setups.

\subsection{Sub-picosecond photon-efficient 3D imaging using single-photon sensors}
\textbf{High level Summary}: This paper discusses a method to reduce the impact of photon pileup, or the effect on measurement data of the fact that photon arrival necessarily prevents measurement of another photon within that particular pulse period \footcite{Heide2018}. This effect, if not accounted for and factored into the parameters of an experimental setup, will severely distort a measured waveform and give inaccurate results for the shape and duration of a measured pulse. The method consist of an algorithm based on estimating the probabilistic distributions of the experiments that could be impacted by pileup, and then deriving and inverse method to predict what the measurement would have been if pileup had not distorted the original pulse measurement. Although the algorithm bases its predictions off of prior probabilities of certain parameters of the pulses expected to be returned, it does not appear to require the algorithm to have a high degree of prior knowledge of the signal to be measured in order to accurately reproduce the undistorted signal.

\textbf{Takeaways relevant to the lab group}: This paper appears to be valuable for the group due to its impact on the raw data measured via a photon counting setup. If distortion is an issue in the raw measurements, there is not much one can do except reduce the probability of arrival of a photon until distortion is reduced to an acceptable, degree, however this raises acquisition time and greatly impacts SNR. So in the future this could be a very beneficial algorithm for improving the raw measurements before they are used as input to additional experimental analysis.

\section{Conclusion}

During this semester, in my lab work, my review of literature, attendance of lab group meetings to listen and learn, and other necessary self-guided education on optical topics, I have increased my knowledge and familiarity with optics, mathematical analysis related to optics and imaging, and even experimental research in general.

In particular with my lab-work, I was able to contribute in a meaningful with useful hands-on contributions in the lab as well as with in depth analysis and accurate conclusions. The body of knowledge and experience I and others now have of the operation and characteristics of the photon-counting equipment is now much greater, and we are well prepared for future experiments both to further perfect the photon-counting usage as well as to incorporate it into more complex and interesting experiments.

Overall I have found this research to be both very interesting as well as formative, as I learned much more than I expected I would be able to in a very short time about a topic I did not feel initially at all qualified to be assisting with.

\printbibliography

\newpage
\begin{appendices}
\section{Deconvolution MATLAB/OCTAVE script}
\verbatiminput{deconvolution.m}

\newpage
\section{Data processing and FWHM calculation Python script}
\verbatiminput{full_width_half_max.py}

\newpage
\section{Triple correlation example MATLAB/OCTAVE script}
\verbatiminput{triple_correlation.m}
\end{appendices}

\end{document}